Не смотря на то, что в большинстве параметров итоговые данные будут совпадать сейчас вижу ключевое различие в группировке CTE и в целом в подходе к решению задачи. Моё решение получилось довольно плоским. Я больше думал про конкретные метрики и формат вывода, а не про общую логику анализа.

В эталонном решении всё построено иначе — каждый CTE отражает какой-то отдельный аналитический срез: история торговли с цивилизациями, зависимость от импорта, влияние дипломатии, анализ экспорта по мастерским, динамика торговли по времени. Это не просто набор метрик, а чётко продуманная структура, где видно, какую задачу решает каждая часть. И итоговый SELECT сразу готовит данные под REST API, то есть решение ещё и удобно в использовании.

У меня же CTE больше как список расчётов по отдельным параметрам. Комментарии есть, но целостной картины они не формируют. В эталонном решении сразу чувствуется системный подход: есть структура, логика, и даже блок с рекомендациями — это уже не просто SQL, а почти как аналитический отчёт.

В следующей задаче стоит не просто собирать нужные числа, а сначала подумать - на какие вопросы я вообще хочу ответить, зачем эти данные нужны, и как это может помочь условному бизнесу. Нужно научиться мыслить именно от анализа и структуры, а не просто от вывода данных.

